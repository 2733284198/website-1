define("components/muffin/forms/index",["Backbone"],function(t,e,i){var o,n,s,r,a,l,p,u,h,c,f,d,v=function(t,e){return function(){return t.apply(e,arguments)}},m={}.hasOwnProperty,g=function(t,e){function i(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);i.prototype=e.prototype;t.prototype=new i;t.__super__=e.prototype;return t},y=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};o=t("Backbone");n=function(t){function e(){this.clearAllErrors=v(this.clearAllErrors,this);this.reset=v(this.reset,this);this.validate=v(this.validate,this);this.commit=v(this.commit,this);this.setValue=v(this.setValue,this);s=e.__super__.constructor.apply(this,arguments);return s}g(e,t);e.prototype.initialize=function(t){var i=this;this.options=t;this.options.html&&this.$el.html(this.options.html);this.context=this.options.context;this.fields={};this.$("[data-field]").each(function(t,o){var n,s,r,a,l,p,u,h;l=$(o).prop("tagName").toLowerCase();r=$(o).attr("data-field");s=$(o).attr("data-editor");a=$(o).attr("data-options");if(s)n=new e.Editor[s]({el:o,options:null!=(u=i.context)?u[a]:void 0});else switch(l){case"input":p=$(o).attr("type");switch(p){case"number":n=new e.Editor.Number({el:o});break;case"checkbox":n=new e.Editor.Checkbox({el:o});break;default:n=new e.Editor.Text({el:o})}break;case"textarea":n=new e.Editor.TextArea({el:o});break;case"select":n=new e.Editor.Select({el:o,options:null!=(h=i.context)?h[a]:void 0});break;default:n=new e.Editor.Text({el:o})}i.fields[r]={editor:n};n.on("change",function(){i.trigger("change:"+r,i,n);i.trigger("change",i,n);return i.onChange(r,n)});n.on("add",function(t){return i.trigger("add:"+r,i,t,n)});n.on("remove",function(t){return i.trigger("remove:"+r,i,t,n)});n.on("focus",function(){return i.trigger("focus:"+r,i,n)});return n.on("blur",function(){return i.trigger("blur:"+r,i,n)})});return this.model?this.update(this.model):void 0};e.prototype.update=function(t){this.model=t;return this.setValue(this.model.toJSON())};e.prototype.setValue=function(t){var e,i,o;o=[];for(e in t){i=t[e];this.fields[e]&&o.push(this.fields[e].editor.setValue(i))}return o};e.prototype.commit=function(){var t,e,i,o,n,s;this.clearAllErrors();t={};s=this.fields;for(o in s){i=s[o];n=i.editor.getValue();e=this.validate(o,n);if(e){this.fields[o].editor.setError(e);return e}null!=n&&(t[o]=n)}this.model.set(t);return null};e.prototype.validate=function(t,e){var i,o,n,s,r,a=this;n=[];r=this.model.validators;for(i in r){s=r[i];if(i===t)if(_.isArray(s))_(s).each(function(i){var o;o=a.test(t,i,e);return o?n.push(o):void 0});else{o=this.test(t,s,e);o&&n.push(o)}}return _.isEmpty(n)?null:n};e.prototype.test=function(t,e,i){var o,n;o=null;n=!0;if(_.isString(e))switch(e){case"required":n=null==i?!1:_.isString(i)?""!==i:_.isArray(i)?!_.isEmpty(i):_.isObject(i)?_.isEmpty(i)?!1:null!=(null!=i?i.id:void 0)?-1!==i.id:!0:!0;n||(o=str.errors[this.model.className].required[t]);break;case"email":null!=i&&""!==i&&(n=/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(i));n||(o="Please enter a valid email address.")}else _.isFunction(e)&&(o=e(i));return o};e.prototype.reset=function(){var t,e,i,o;i=this.fields;o=[];for(e in i){t=i[e];o.push(t.editor.reset())}return o};e.prototype.onChange=function(t,e){var i,o;e.clearError();o=e.getValue();i=this.validate(t,o);if(i)return this.fields[t].editor.setError(i);this.model.set(t,o);return logging.debug(JSON.stringify(this.model.toJSON()))};e.prototype.clearAllErrors=function(){var t,e,i,o;i=this.fields;o=[];for(e in i){t=i[e];o.push(t.editor.clearError())}return o};e.prototype.remove=function(){var t,i,o;o=this.fields;for(i in o){t=o[i];t.editor.remove()}return e.__super__.remove.apply(this,arguments)};return e}(o.View);n.Editor=function(t){function e(){this.clearError=v(this.clearError,this);this.setError=v(this.setError,this);this.onBlur=v(this.onBlur,this);this.onFocus=v(this.onFocus,this);this.onChange=v(this.onChange,this);this.render=v(this.render,this);r=e.__super__.constructor.apply(this,arguments);return r}g(e,t);e.prototype.defaultValue=null;e.prototype.events={change:"onChange",focus:"onFocus",blur:"onBlur"};e.prototype.initialize=function(){return this.setValue(this.defaultValue)};e.prototype.render=function(){return this};e.prototype.getValue=function(){return this.$el.val()};e.prototype.setValue=function(t){return null!=t?this.$el.val(t):void 0};e.prototype.reset=function(){return this.setValue(this.defaultValue)};e.prototype.focus=function(){return this.hasFocus?void 0:this.$el.focus()};e.prototype.blur=function(){return this.hasFocus?this.$el.blur():void 0};e.prototype.onChange=function(){return this.trigger("change",this)};e.prototype.onFocus=function(){return this.trigger("focus",this)};e.prototype.onBlur=function(){return this.trigger("blur",this)};e.prototype.setError=function(){return this.$el.addClass("rederror")};e.prototype.clearError=function(){return this.$el.removeClass("rederror")};return e}(o.View);n.Editor.Text=function(t){function e(){a=e.__super__.constructor.apply(this,arguments);return a}g(e,t);e.prototype.defaultValue="";return e}(n.Editor);n.Editor.Number=function(t){function e(){this.setValue=v(this.setValue,this);this.getValue=v(this.getValue,this);this.onKeypress=v(this.onKeypress,this);l=e.__super__.constructor.apply(this,arguments);return l}g(e,t);e.prototype.defaultValue=0;e.prototype.events={keypress:"onKeypress"};e.prototype.initialize=function(){e.__super__.initialize.apply(this,arguments);return this.el.oninput=this.onChange};e.prototype.onKeypress=function(){};e.prototype.getValue=function(){var t;t=this.$el.val();_.isString(t)&&(t=parseInt(t,10));_.isNaN(t)&&(t=null);return t};e.prototype.setValue=function(t){if(_.isNumber(t))return this.$el.val(t);if(_.isString(t)){t=parseInt(t,10);if(!_.isNaN(t))return this.$el.val(t)}};return e}(n.Editor);n.Editor.TextArea=function(t){function e(){p=e.__super__.constructor.apply(this,arguments);return p}g(e,t);return e}(n.Editor);n.Editor.Checkbox=function(t){function e(){this.setValue=v(this.setValue,this);this.getValue=v(this.getValue,this);u=e.__super__.constructor.apply(this,arguments);return u}g(e,t);e.prototype.defaultValue=!1;e.prototype.getValue=function(){return this.$el.prop("checked")};e.prototype.setValue=function(t){return this.$el.prop("checked",t)};return e}(n.Editor);n.Editor.Checkboxes=function(t){function e(){this.setValue=v(this.setValue,this);this.getValue=v(this.getValue,this);this.render=v(this.render,this);this.renderOptions=v(this.renderOptions,this);this.setOptions=v(this.setOptions,this);h=e.__super__.constructor.apply(this,arguments);return h}g(e,t);e.prototype["default"]=[];e.prototype.optionTemplate=_.template('<li><input type="checkbox" name="checkbox-group-<%- id %>" value=<%- id %> class="checkbox" /><%- value %></li>');e.prototype.setOptions=function(t){this.collection=t;this.renderOptions();return this.collection.on("reset",this.renderOptions)};e.prototype.renderOptions=function(){var t=this;this.$el.empty();this.collection&&this.collection.each(function(e){var i;i=$(t.optionTemplate(e.toOption()));return t.$el.append(i)});return this};e.prototype.render=function(){this.setValue(this.value);this.trigger("change",this);return this};e.prototype.getValue=function(){var t;t=[];this.$(":checked").each(function(e,i){var o;o=$(i).val();_.isNaN(parseInt(o,10))||(o=parseInt(o,10));return t.push({id:o})});return t};e.prototype.setValue=function(t){var e;this.value=t;if(this.collection){e=_(t).pluck("id");return this.$(":checkbox").each(function(t,i){var o,n;o=(n=parseInt($(i).val(),10),y.call(e,n)>=0);return $(i).prop("checked",o)})}};return e}(n.Editor);n.Editor.Select=function(t){function e(){this.clearError=v(this.clearError,this);this.setError=v(this.setError,this);this.reset=v(this.reset,this);this.setValue=v(this.setValue,this);this.getValue=v(this.getValue,this);this.render=v(this.render,this);this.onChange=v(this.onChange,this);this.renderOptions=v(this.renderOptions,this);this.setOptions=v(this.setOptions,this);c=e.__super__.constructor.apply(this,arguments);return c}g(e,t);e.prototype.defaultValue=-1;e.prototype.optionTemplate=_.template("<option value=<%- id %>><%- value %></option>");e.prototype.initialize=function(t){this.value=this.defaultValue;return t.options?this.setOptions(t.options):void 0};e.prototype.setOptions=function(t){this.options=t;this.renderOptions();return this.options instanceof o.Collection?this.options.on("reset",this.renderOptions):void 0};e.prototype.renderOptions=function(){var t,e=this;this.$el.empty();t=$(this.optionTemplate({id:-1,value:"Select"}));this.$el.append(t);this.options instanceof o.Collection&&this.options.each(function(t){var i;i=$(e.optionTemplate(t.toOption()));return e.$el.append(i)});return this.render()};e.prototype.onChange=function(){return this.trigger("change:selection",this)};e.prototype.render=function(){this.$el.val(this.value);this.trigger("change:selection",this);return this};e.prototype.getValue=function(){var t;t=this.$el.val();_.isNaN(parseInt(t,10))||(t=parseInt(t,10));"true"===t&&(t=!0);"false"===t&&(t=!1);return this.options instanceof o.Collection?-1!==t?{id:t}:null:t};e.prototype.setValue=function(t){var e;this.value=null!=(e=null!=t?t.id:void 0)?e:t;return this.$el.val(this.value)};e.prototype.reset=function(){this.value=this.defaultValue;return this.$el.val(this.value)};e.prototype.setError=function(){return this.$el.parent().addClass("rederror")};e.prototype.clearError=function(){return this.$el.parent().removeClass("rederror")};return e}(n.Editor);n.Editor.Date=function(t){function e(){this.getValue=v(this.getValue,this);this.setValue=v(this.setValue,this);f=e.__super__.constructor.apply(this,arguments);return f}g(e,t);e.prototype.initialize=function(){this.displayDateFormat="mm/dd/yy";this.serverDateFormat="yy-mm-dd";return this.$el.datepicker({dateFormat:this.displayDateFormat})};e.prototype.convertDateFormat=function(t,e,i){var o;o=$.datepicker.parseDate(t,i);return $.datepicker.formatDate(e,o)};e.prototype.setValue=function(t){this.value=this.convertDateFormat(this.serverDateFormat,this.displayDateFormat,t);return this.$el.val(this.value)};e.prototype.getValue=function(){var t;t=this.$el.val();return this.convertDateFormat(this.displayDateFormat,this.serverDateFormat,t)};e.prototype.reset=function(){return this.$el.datepicker("setDate",null)};return e}(n.Editor);n.Editor.DateTime=function(t){function e(){this.getValue=v(this.getValue,this);this.setValue=v(this.setValue,this);d=e.__super__.constructor.apply(this,arguments);return d}g(e,t);e.prototype.initialize=function(){this.displayDateFormat="mm/dd/yy";return this.$("input").datepicker({dateFormat:this.displayDateFormat})};e.prototype.setValue=function(t){var e,i,o,n;i=new Date(t);this.$("input").val($.datepicker.formatDate(this.displayDateFormat,i));o=i.getHours();n=i.getMinutes();e=o>=12?"PM":"AM";o%=12;"PM"===e&&0===o&&(o=12);this.$("select[name='hours']").val(o);this.$("select[name='minutes']").val(n);return this.$("select[name='ampm']").val(e)};e.prototype.getValue=function(){var t,e,i,o,n;e=this.$("input").val();o=this.$("select[name='hours']").val();n=this.$("select[name='minutes']").val();t=this.$("select[name='ampm']").val();i=""+e+" "+o+":"+n+" "+t;return new Date(i).getTime()};e.prototype.reset=function(){this.$("input").datepicker("setDate",null);this.$("select[name='hours']").val(0);this.$("select[name='minutes']").val(0);return this.$("select[name='ampm']").val("AM")};return e}(n.Editor);i.exports=n});